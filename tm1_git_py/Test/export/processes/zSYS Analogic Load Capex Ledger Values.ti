#region Prolog
#****Begin: Generated Statements***
#****End: Generated Statements****

sLedgerDimensionName = 'Capex Ledger';
sSubsetName = 'CapexAllN';
sMDX = 
'
{
	TM1FILTERBYLEVEL({
		[Capex Ledger].[Capex Ledger].Members
	}, 0)
}
';

HierarchySubsetCreate(sLedgerDimensionName, sLedgerDimensionName, sSubsetName, 1);
HierarchySubsetMDXSet(sLedgerDimensionName, sLedgerDimensionName, sSubsetName, sMDX);

nStartLedger = 1;

nMaxledgerLen = SubsetGetSize(sLedgerDimensionName, sSubsetName);
nMaxledgerLen = 1;
j = nStartLedger;

While( j <= nMaxledgerLen);
  sInputLedger = SubsetGetElementName(sLedgerDimensionName, sSubsetName, j);
  
    IF( pLastYear = 1);
      
      sPeriodSubset = 'Last_Actual_Year';
      sPeriodDim = 'Period';
      nStartPeriod = 1;
      nMaxPeriodLen = SubsetGetSize(sPeriodDim, sPeriodSubset);
      i = nStartPeriod;
      
      WHILE(i <= nMaxPeriodLen);
        
        sInputPeriod = SubsetGetElementName(sPeriodDim, sPeriodSubset, i);
       # kockat atirni
        CellPutN(0, 'Capex', pVersion, sInputPeriod, sInputLedger, 'Value');
        i = i+1;
        
      END;
      
    ENDIF;
    
    IF( pAllPeriod = 1);
      
      sPeriodSubset = 'All N';
      sPlanningPeriodSubset = 'Planning Period';
      sPeriodDim = 'Period';
      nStartPeriod = 1;
      nMaxPeriodLen = SubsetGetSize(sPeriodDim, sPeriodSubset);
      i = nStartPeriod;
      
      WHILE(i <= nMaxPeriodLen);
        
        sInputPeriod = SubsetGetElementName(sPeriodDim, sPeriodSubset, i);
        
        IF(SubsetElementExists('Period', sPlanningPeriodSubset, sInputPeriod) = 0);
          # kockat atirni
          CellPutN(0, 'Capex', pVersion, sInputPeriod, sInputLedger, 'Value');
        ENDIF;
        
        i = i+1;
        
      END;
    ENDIF;
  
j = j+ 1;
#END ledger while
END;
#endregion
#region Metadata
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
#region Data
#****Begin: Generated Statements***
#****End: Generated Statements****
#Botond 11.20

nNumberValue = StringToNumber(vEgyenleg);
sDate = DELET(vDtum, 8, 3);
sDate = DELET(sDate, 5, 1);
sProjektKod = DELET(vProjektKod, 3, 1);
sProjektKodTeruleti = sProjektkod;
sProjektKod = DELET(sProjektKod, 5, 3);
sProjektKodTeruleti = DELET(sProjektKodTeruleti, 5, 1);


IF ( SubsetElementExists(sLedgerDimensionName, sSubsetName, sProjektKod) = 0 & SubsetElementExists(sLedgerDimensionName, sSubsetName, sProjektKodTeruleti) = 0); 
    itemskip;
ENDIF;

IF( pAllPeriod = 1);
  sPeriodSubsetName = 'Planning Period';
  IF ( SubsetElementExists('Period', sPeriodSubsetName, sDate) = 0); 
    
    IF(sProjektKodTeruleti @<> '011410' & sProjektKodTeruleti @<> '011411');
      
        nPreviousValueForSum = CellGetN('Capex', pVersion, sDate, sProjektKod, 'Value');
        nNumberValue = nNumberValue + nPreviousValueForSum;
        CellPutN(nNumberValue, 'Capex', pVersion, sDate, sProjektKod, 'Value');
      
    ENDIF;
    
    IF (sProjektKodTeruleti @= '011410' % sProjektKodTeruleti @= '011411');
      
          nPreviousValueForSum = CellGetN('Capex', pVersion, sDate, sProjektKodTeruleti, 'Value');
          nNumberValue = nNumberValue + nPreviousValueForSum;
          CellPutN(nNumberValue, 'Capex', pVersion, sDate, sProjektKodTeruleti, 'Value');
          
    ENDIF;
    
  ENDIF;
  

ENDIF;


IF( pLastYear = 1);
  sPeriodSubsetName = 'Last_Actual_Year';
  IF ( SubsetElementExists('Period', sPeriodSubsetName, sDate) = 1);
    
    IF(sProjektKodTeruleti @<> '011410' & sProjektKodTeruleti @<> '011411');
      
      nPreviousValueForSum = CellGetN('Capex', pVersion, sDate, sProjektKod, 'Value');
      nNumberValue = nNumberValue + nPreviousValueForSum;
      CellPutN(nNumberValue, 'Capex', pVersion, sDate, sProjektKod, 'Value');
    
    ENDIF;

    
    IF (sProjektKodTeruleti @= '011410' % sProjektKodTeruleti @= '011411');
      
          nPreviousValueForSum = CellGetN('Capex', pVersion, sDate, sProjektKodTeruleti, 'Value');
          nNumberValue = nNumberValue + nPreviousValueForSum;
          CellPutN(nNumberValue, 'Capex', pVersion, sDate, sProjektKodTeruleti, 'Value');
          
    ENDIF;
      
  ENDIF;
  
ENDIF;



#endregion
#region Epilog
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
