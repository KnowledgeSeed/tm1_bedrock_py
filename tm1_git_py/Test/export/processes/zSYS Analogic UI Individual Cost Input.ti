#region Prolog
#****Begin: Generated Statements***
#****End: Generated Statements****

#Antal Botond 05.07

#Botond preprod merge test 08.17

#pMode
#1: one month
#2: more month

nInputValue = stringToNumber(pValue);
sOtherCostMeasure = 'Value';
sLineitem = 'Cost';

sAllNTimeSubset = 'Actual Period N level';
sPeriodDim = 'Period';

#1: one value
# sima hónap
# éves
IF(pMode = 1);
  # sima hónap
  IF( Long(pPeriod) = 6);
    CellPutN(nInputValue, 'Individual Cost', pVersion, pPeriod, pLedger, sLineitem, sOtherCostMeasure);
  ENDIF;
  
  # éves
  IF( Long(pPeriod) = 4);
    nInputValueHavi = nInputValue\12;
    i=1;
    WHILE( i<=12);
      sActualPeriod = pPeriod | numberToString(i);
      IF( i<10);
        sActualPeriod = pPeriod | '0' | numberToString(i);
      ENDIF;
      CellPutN(nInputValueHavi, 'Individual Cost', pVersion, sActualPeriod, pLedger, sLineitem, sOtherCostMeasure);
      i=i+1;
    END;
  ENDIF;
  
#1: one value end
ENDIF;

#2: more month
# sima hónap
# éves
IF(pMode = 2);
  # sima hónap
  IF( Long(pPeriod) = 6);
    sPeriodStartMonth = pPeriod;
    nMaxPlanningPeriodSubsetLen = SubsetGetSize(sPeriodDim, sAllNTimeSubset);
    i = SubsetElementGetIndex(sPeriodDim, sAllNTimeSubset, sPeriodStartMonth);
    While(i <= nMaxPlanningPeriodSubsetLen);
      sInputPeriod = SubsetGetElementName(sPeriodDim, sAllNTimeSubset, i);
      CellPutN(nInputValue, 'Individual Cost', pVersion, sInputPeriod, pLedger, sLineitem, sOtherCostMeasure);
      i = i+1;
    END;
  ENDIF;
  
  # éves
  IF( Long(pPeriod) = 4);
    nInputValueHavi = nInputValue\12;
    sPeriodStartMonth = pPeriod | '01';
    nMaxPlanningPeriodSubsetLen = SubsetGetSize(sPeriodDim, sAllNTimeSubset);
    i = SubsetElementGetIndex(sPeriodDim, sAllNTimeSubset, sPeriodStartMonth);
    While(i <= nMaxPlanningPeriodSubsetLen);
      sInputPeriod = SubsetGetElementName(sPeriodDim, sAllNTimeSubset, i);
      CellPutN(nInputValueHavi, 'Individual Cost', pVersion, sInputPeriod, pLedger, sLineitem, sOtherCostMeasure);
      i = i+1;
    END;
  
  ENDIF;

##2: more month
ENDIF;


#Infláció
#Botond 09.05


IF( pMode = 3);
  
  sPeriodStartMonth = CellGetS('zSYS Maintenance Parameter', 'ActualMonth', 'S Type');
  
  nMaxPlanningPeriodSubsetLen = SubsetGetSize(sPeriodDim, sAllNTimeSubset);
  
  sLastMonth = attrs(sPeriodDim, sPeriodStartMonth, 'PREV_1M');
  nLastMonthValue = CellGetN('Individual Cost', pVersion, sLastMonth, pLedger, sLineitem, sOtherCostMeasure);
  
  nCurrentYear = stringToNumber(DELET(sPeriodStartMonth,5,2));
  sCurrentYear = numberToString(nCurrentYear);
  
  i = SubsetElementGetIndex(sPeriodDim, sAllNTimeSubset, sPeriodStartMonth);
    While(i <= nMaxPlanningPeriodSubsetLen);
      # adott hónap
      sInputPeriod = SubsetGetElementName(sPeriodDim, sAllNTimeSubset, i);
      nInputYear = stringToNumber(DELET(sInputPeriod,5,2));
      
      IF( DELET(sInputPeriod,1,4)@= '01' &  (nCurrentYear < nInputYear));
        
        nCurrentYear = nCurrentYear + 1;
        sCurrentYear = numberToString(nCurrentYear);
        
        sLastMonth = attrs(sPeriodDim, sInputPeriod, 'PREV_1M');
        nLastMonthValue = CellGetN('Individual Cost', pVersion, sLastMonth, pLedger, sLineitem, sOtherCostMeasure);
        
      ENDIF;

      nInflacio = CellGetN('Planning Driver', pVersion, sCurrentYear, 'Inflation', 'N Type');
      
      nGrowthRate = nInflacio + 1;
      
      nInputValue = nLastMonthValue * nGrowthRate;
      
      CellPutN(nInputValue, 'Individual Cost', pVersion, sInputPeriod, pLedger, sLineitem, sOtherCostMeasure);
      i = i+1;
    END;
ENDIF;

#endregion
#region Metadata
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
#region Data
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
#region Epilog
#****Begin: Generated Statements***
#****End: Generated Statements****

sToday = Today(1);
CellPutS(sToday, '}ElementAttributes_Version', pVersion, 'Last Updated');
CellPutS(pUser, '}ElementAttributes_Version', pVersion, 'Last Updated By');
#endregion
