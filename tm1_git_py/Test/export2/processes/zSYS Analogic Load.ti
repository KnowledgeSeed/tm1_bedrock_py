#region Prolog
#****Begin: Generated Statements***
#****End: Generated Statements****

# =========================================================
# Original Date Created              2023.05.24
# Originator                         Ullmann Dávid
# Purpose                            Product Loader Wrapper Process - Updates all 3 dimensions with the following things:
# Change Date                               dimension structure, attributes, elements, custom totals, components, subsets
# Change Request Reference    
# Change Made by                     
# =========================================================

# basic algorithm
# step 1: read file
# step 2: build product dimensions' base (all N level with total), add item or just refresh attributes
# step 3: build custom totals with components, build additional subdivided if needed, also generate subsets, update subset dim element attributes

#pElementsFileName        = 'termek.csv';
#pDimensionFileName       = 'Product.csv';

pProcName_Deleteall      = 'zSYS Maintenance Dimension Import from CSV';
pProcName_UpdateBase     = 'zSYS Analogic Load Product Update Base with ODBC';
pProcName_UpdateAttr     = 'zSYS Analogic Load Product Update Time Dependent Attributes';
pProcName_UpdateAttrSum  = 'zSYS Analogic Load Product Update Time Dependent Attributes Sum';
pProcName_UpdateSubsets  = 'zSYS Analogic Load Product Update Subsets with ODBC';
pProcName_Movements      = 'zSYS Analogic Subscription Movement Assignment Calculate';

#pColumnDelimiter         = ';';
#pDecimalSeparator        = '.';
#pThousandSeparator       = '';
#pQuoteChar               = '"';
#pCharacterSet            = '';
#pHeaderRow_UpdateBase    = '1';
#pHeaderRow_UpdateSubsets = '0';

sDimensionName_Base      = 'Product';
sDimensionName_Source    = 'Source Product';
sDimensionName_Target    = 'Target Product';

sElementName_Source      = ' New';
sElementAlias_Source     = ' Új';
sElementName_Target      = ' Terminated';
sElementAlias_Target     = ' Felmondott';
sCaptionAttribute        = 'Caption';

# rebuild all dimension structure if needed

if(pEnableDeleteAll = 1);
  
#  LogOutput('INFO', 'Delete All Enabled');
  
  sSwitch = 'yes';
  ExecuteProcess(pProcName_Deleteall,
     'pDimName', sDimensionName_Base,
     'pRebuildDimension', sSwitch,
     'pSourceFile', pDimensionFileName,
     'pCompSortType', '',
     'pCompSortSense', '',
     'pElSortType', 'ByHierarchy',
     'pElSortSense', '',
     'pCallerID', ''
    );
    
  ExecuteProcess(pProcName_Deleteall,
     'pDimName', sDimensionName_Source,
     'pRebuildDimension', sSwitch,
     'pSourceFile', pDimensionFileName,
     'pCompSortType', '',
     'pCompSortSense', '',
     'pElSortType', 'ByHierarchy',
     'pElSortSense', '',
     'pCallerID', ''
    );
  
  ExecuteProcess(pProcName_Deleteall,
     'pDimName', sDimensionName_Target,
     'pRebuildDimension', sSwitch,
     'pSourceFile', pDimensionFileName,
     'pCompSortType', '',
     'pCompSortSense', '',
     'pElSortType', 'ByHierarchy',
     'pElSortSense', '',
     'pCallerID', ''
    );  
endif;

# run element update on dimensions' base

if(pEnableUpdateBase = 1);
  
#  LogOutput('INFO', 'Update Base Enabled');
  
  ExecuteProcess(pProcName_UpdateBase,
     'pDimensionName',     sDimensionName_Base
    );
    
  ExecuteProcess(pProcName_UpdateBase,
     'pDimensionName',     sDimensionName_Source
    );
    
  ExecuteProcess(pProcName_UpdateBase,
     'pDimensionName',     sDimensionName_Target
    );
endif;


if(pEnableUpdateMovements = 1);
  
#  LogOutput('INFO', 'Update Movements Enabled');
  
  ExecuteProcess(pProcName_Movements, 'pRun', 1);
endif;

if(pEnableUpdateOpening = 1);
  ExecuteProcess('zSYS Analogic Load Closing 2020');
endif;

if(pEnableUpdateTransactions = 1);
  ExecuteProcess('zSYS Analogic Load Transactions',
   'pSourceFile', 'transactions.csv'
  );
endif;

# run time dependent attributes here 

if(pEnableUpdateTDAttributes = 1);
  
#  LogOutput('INFO', 'Update Attributes Enabled');
  
  ExecuteProcess(pProcName_UpdateAttr,
     'pDimensionName', sDimensionName_Source
    );
    
  ExecuteProcess(pProcName_UpdateAttr,
     'pDimensionName', sDimensionName_Target
    );
    
#  LogOutput('INFO', 'Update Attributes Sum Enabled');
    
  ExecuteProcess(pProcName_UpdateAttrSum,
     'pDimensionName', sDimensionName_Source
    );
    
  ExecuteProcess(pProcName_UpdateAttrSum,
     'pDimensionName', sDimensionName_Target
    );
    
    
#  LogOutput('INFO', 'Update Attributes Sum Done');
endif;

# run component update on custom totals and update subsets

if(pEnableUpdateSubsets = 1);
  
#  LogOutput('INFO', 'Update Subsets Enabled');
    
  ExecuteProcess(pProcName_UpdateSubsets,
     'pDimensionName',     sDimensionName_Source
    );
    
  ExecuteProcess(pProcName_UpdateSubsets,
     'pDimensionName',     sDimensionName_Target
    );
    
  ExecuteProcess(pProcName_UpdateSubsets,
     'pDimensionName',     sDimensionName_Base
    );
endif;

if(pEnableUpdateOther = 1);
  
#  LogOutput('INFO', 'Update other enabled');
  
  ExecuteProcess('zSYS Analogic Load Product Update Weights');
  
endif;

# process end
#endregion
#region Metadata
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
#region Data
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
#region Epilog
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
