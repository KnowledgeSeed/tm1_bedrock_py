#region Prolog
#****Begin: Generated Statements***
#****End: Generated Statements****

#pSourceFile = 'Felmondott.csv';
#sSourceFolder = 'data_source/';
#
#sSourceFile = sSourceFolder | pSourceFile;
#DatasourceNameForServer = sSourceFile;
#DatasourceNameForClient = sSourceFile;
#DatasourceASCIIDelimiter=';';
#DatasourceASCIIDecimalSeparator='.';
#DatasourceASCIIQuoteCharacter='"';
#DataSourceType='CHARACTERDELIMITED';
#DatasourceASCIIHeaderRecords = 1;

# Fix Parameters

sCubeName = 'Subscription Plan';
DataSourceType = 'ODBC';

sOpeningMonth = CellGetS('zSYS Maintenance Parameter', 'OpeningMonth', 'S Type');








#endregion
#region Metadata
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
#region Data
#****Begin: Generated Statements***
#****End: Generated Statements****

sDimName = 'Period';

If(DimensionElementExists(sDimName, vDate)= 0);
    itemskip;
EndIf;

If(vSalesChannel @= 'CC');
    vSalesChannel = 'Call Center';
EndIf;

If(vSalesChannel @= 'UF');
    vSalesChannel = 'Customer Service';
EndIf;


sProductID = DimensionElementPrincipalName('Product', vProduct);

# 2 termék tranzakcióit ki kell venni mert negatívban menne a záróértékek
# VIP PAK/3 ID=736
If( sProductID @= '736' );
  itemskip;
ENDIF;
# 60/12 TESZT ID=27
If( sProductID @= '27' );
  itemskip;
ENDIF;

IF( pAllPeriod = 1);
#  sPeriodSubsetName = 'Planning Period';
#  IF ( SubsetElementExists('Period', sPeriodSubsetName, vDate) = 0);  

  IF( stringtonumber(vDate) > stringtonumber(sOpeningMonth));
    CellPutN( vValue,'Subscription Plan', pVersion, vDate, vLoyalty, vSalesChannel, 'Terminated', sProductID, 'Terminated decrease', 'base input');
    CellPutN( vValue,'Subscription Plan', pVersion, vDate, vLoyalty, vSalesChannel, sProductID, 'Terminated', 'Terminated increase', 'base input');
  ENDIF;
ENDIF;


IF( pLastYear = 1);
  sPeriodSubsetName = 'Last_Actual_Year';
  IF ( SubsetElementExists('Period', sPeriodSubsetName, vDate) = 1);
  CellPutN( vValue,'Subscription Plan', pVersion, vDate, vLoyalty, vSalesChannel, 'Terminated', sProductID, 'Terminated decrease', 'base input');
  CellPutN( vValue,'Subscription Plan', pVersion, vDate, vLoyalty, vSalesChannel, sProductID, 'Terminated', 'Terminated increase', 'base input');
  ENDIF;

ENDIF;
#endregion
#region Epilog
#****Begin: Generated Statements***
#****End: Generated Statements****
#endregion
