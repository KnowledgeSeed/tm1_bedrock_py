SKIPCHECK;
#1
# Módos Dávid 2024 09 13

# 1, verziószabályok
# 2, Efi C-s szabályok és total cost C-s szabályok
# 3, Currency
# 4, EFI áthúzása
# 5, Channel Cost total (lineitem) szabály - Chennel Period Dependent Attri alapján
# 6, Jogdíj

# 2, Efi C-s szabályok
['Channel Cost Lineitem':'Channel Cost Lineitem':'CPS', 'Channel Cost Measure':'Channel Cost Measure':'Value'] = C:
IF( ELLEV('Period',!Period)>0,
  DB('Channel Cost', !Version, !Period | '12', !Channel, !Product, !Currency, !Channel Cost Lineitem, !Channel Cost Measure),
Continue);

['Channel Cost Lineitem':'Channel Cost Lineitem':'cpsReport', 'Channel Cost Measure':'Channel Cost Measure':'Value'] = C:
IF( ELLEV('Period',!Period)>0,
  DB('Channel Cost', !Version, !Period | '12', !Channel, !Product, !Currency, !Channel Cost Lineitem, !Channel Cost Measure),
Continue);

['Channel Cost Lineitem':'Channel Cost Lineitem':'Channel Cost And Royalty', 'Currency':'Currency Total', 'Channel Cost Measure':'Channel Cost Measure':'Value'] = C:
['Currency':'HUF']
+
#['Currency':'EUR'] * 390
['Currency':'EUR'] * 390
+
['Currency':'USD'] * 360;

# 3, Currency C-s szabályok
#Currency EFI-nél

### itt ki lehet cserélni N-esre

['Channel Cost Lineitem':'EFI','Currency':'Currency':'Currency Total','Channel Cost Measure':'Value'] = C:
IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'Currency') @= 'EUR',
  DB('Channel Cost', !Version, !Period, !Channel, !Product, 'EUR', !Channel Cost Lineitem, !Channel Cost Measure),
 Continue);
 
['Channel Cost Lineitem':'EFI','Currency':'Currency':'Currency Total','Channel Cost Measure':'Value'] = C:
IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'Currency') @= 'USD',
 DB('Channel Cost', !Version, !Period, !Channel, !Product, 'USD', !Channel Cost Lineitem, !Channel Cost Measure),
 DB('Channel Cost', !Version, !Period, !Channel, !Product, 'HUF', !Channel Cost Lineitem, !Channel Cost Measure)
 );


['Currency':'Currency':'Currency Total','Channel Cost Measure':'Value'] = C:
IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'Currency') @= 'EUR',
  DB('Channel Cost', !Version, !Period, !Channel, !Product, 'EUR', !Channel Cost Lineitem, !Channel Cost Measure)
  *
  #390,
  390,
 Continue);
 
['Currency':'Currency':'Currency Total','Channel Cost Measure':'Value'] = C:
IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'Currency') @= 'USD',
  DB('Channel Cost', !Version, !Period, !Channel, !Product, 'USD', !Channel Cost Lineitem, !Channel Cost Measure)
  *
  #360,
  360,
Continue);


['Currency':'Currency':'Currency Total','Channel Cost Measure':'Value'] = C:
IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'Currency') @= 'HUF',
DB('Channel Cost', !Version, !Period, !Channel, !Product, 'HUF', !Channel Cost Lineitem, !Channel Cost Measure),
DB('Channel Cost', !Version, !Period, !Channel, !Product, 'HUF', !Channel Cost Lineitem, !Channel Cost Measure)
+
DB('Channel Cost', !Version, !Period, !Channel, !Product, 'USD', !Channel Cost Lineitem, !Channel Cost Measure) * 360
+
DB('Channel Cost', !Version, !Period, !Channel, !Product, 'EUR', !Channel Cost Lineitem, !Channel Cost Measure) * 390
);



['Channel Cost Lineitem':'Channel Cost Total','Channel Cost Measure':'Value'] =C:
 IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'EFI') = 1,
 DB('Channel Cost', !Version, !Period, !Channel, !Product, !Currency,'EFI Cost', !Channel Cost Measure),
 Continue);
 

# 5, Channel Cost total (lineitem) szabály - Chennel Period Dependent Attri alapján
# Flat
['Channel Cost Lineitem':'Channel Cost Lineitem':'Channel Cost Total','Channel Cost Measure':'Value'] = C:
IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'FLAT') = 1,
 DB('Channel Cost', !Version, !Period, !Channel, !Product, !Currency, 'Flat', 'Value'),
 Continue);

# Csoportos flat
['Channel Cost Lineitem':'Channel Cost Total','Channel Cost Measure':'Value'] =C:
 IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'CS.FL') = 1,
 DB('Channel Cost', !Version, !Period, !Channel, !Product, !Currency,'CS.FL', !Channel Cost Measure),
 Continue);

# 1, verziószabályok
[]= N:
IF(ELISPAR('Version','Report',!Version) = 1,
STET,Continue);


# 4, EFI áthúzása
['Channel Cost Lineitem':'Channel Cost Lineitem':'EFI', 'Channel Cost Measure':'Channel Cost Measure':'Value'] = C: STET;

['Channel Cost Lineitem':'Channel Cost Lineitem':'EFI', 'Channel Cost Measure':'Channel Cost Measure':'Value'] = N:
  0.5
  *
  ( DB('Subscription Report', !Version, !Period, 'Total', 'Total', !Product, 'Value')
  +
  DB('Subscription Report', !Version, DB('}ElementAttributes_Period', !Period, 'PREV_1M'), 'Total', 'Total', !Product, 'Value')
  )
  *
  DB('Channel Product Assignment', !Version, !Period, !Channel, !Product, 'Assignment');

# EFI
# FEEDER 1
['Channel Cost Lineitem':'EFI Cost','Channel Cost Measure':'Value'] =N:
 IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'EFI') = 1,
 DB('Channel Cost', !Version, !Period, !Channel, !Product, !Currency, 'EFI', !Channel Cost Measure)
 *
 DB('Channel Cost', !Version, !Period, !Channel, 'Nem tartozik termekhez', !Currency, 'CPS', !Channel Cost Measure),
 STET);


# 6, Jogdíj
# FEEDER 2
['Channel Cost Lineitem':'Channel Cost Lineitem':'Royalty EFI Cost','Currency':'HUF','Channel Cost Measure':'Channel Cost Measure':'Value'] = N: 
  DB('Channel Cost', !Version, !Period, !Channel, !Product, !Currency, 'EFI', !Channel Cost Measure)
  *
  DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'Jogdíj');


## cpsReportCalc
['Channel Cost Lineitem':'Channel Cost Lineitem':'cpsReport','Product':'Nem tartozik termekhez','Currency':'HUF','Channel Cost Measure':'Value'] = N:
IF( DB('Channel Time Dependent Attributes', !Version, !Period, !Channel, 'FLAT') = 1,
 DB('Channel Cost', !Version, !Period, !Channel, 'Total Products' , 'Currency Total', 'Flat', 'Value')
 \
 DB('Channel Cost', !Version, !Period, !Channel, 'Total Products' , 'HUF', 'EFI', 'Value')
 ,
 DB('Channel Cost', !Version, !Period, !Channel, !Product , 'Currency Total', 'CPS', 'Value'));



FEEDERS;
# FEEDER 1
# Efi Feeder
['Version':'Forecast','Channel Cost Lineitem':'CPS'] => ['Channel Cost Lineitem':'EFI Cost'];
['Version':'Forecast','Channel Cost Lineitem':'EFI'] => ['Channel Cost Lineitem':'EFI Cost'];

# FEEDER 2
#cpsReport
['Version':'Forecast','Channel Cost Lineitem':'CPS'] => ['Channel Cost Lineitem':'cpsReport'];
['Version':'Forecast','Channel Cost Lineitem':'EFI'] => ['Channel Cost Lineitem':'cpsReport'];
['Version':'Forecast','Channel Cost Lineitem':'Flat'] => ['Channel Cost Lineitem':'cpsReport'];


# ez se kell
#['Version':'Forecast','Channel Cost Lineitem':'EFI Cost'] => ['Channel Cost Lineitem':'Channel Cost Total'];

#nem kell
#['Version':'Forecast','Currency':'HUF'] => ['Currency':'Currency Total'];
#['Version':'Forecast','Currency':'EUR'] => ['Currency':'Currency Total'];
#['Version':'Forecast','Currency':'USD'] => ['Currency':'Currency Total'];


# FEEDER 2
# Jogdíj
# ez sem kell
#['Version':'Forecast','Channel Cost Lineitem':'Royalty EFI Cost'] => ['Channel Cost Lineitem':'Royalty'];
['Version':'Forecast','Channel Cost Lineitem':'EFI'] => ['Channel Cost Lineitem':'Royalty EFI Cost'];


# FEEDER Direct Cost
#['Version':'Forecast', 'Channel Cost Lineitem':'Channel Cost And Royalty'] =>
#DB('Direct Cost', !Version, !Period, '81505', 'Cost', 'Value');



